"use strict";(self.webpackChunkwebsite=self.webpackChunkwebsite||[]).push([[8717],{9613:(e,n,t)=>{t.d(n,{Zo:()=>u,kt:()=>m});var a=t(9496);function o(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function r(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);n&&(a=a.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,a)}return t}function i(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?r(Object(t),!0).forEach((function(n){o(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):r(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function s(e,n){if(null==e)return{};var t,a,o=function(e,n){if(null==e)return{};var t,a,o={},r=Object.keys(e);for(a=0;a<r.length;a++)t=r[a],n.indexOf(t)>=0||(o[t]=e[t]);return o}(e,n);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(a=0;a<r.length;a++)t=r[a],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(o[t]=e[t])}return o}var l=a.createContext({}),c=function(e){var n=a.useContext(l),t=n;return e&&(t="function"==typeof e?e(n):i(i({},n),e)),t},u=function(e){var n=c(e.components);return a.createElement(l.Provider,{value:n},e.children)},d={inlineCode:"code",wrapper:function(e){var n=e.children;return a.createElement(a.Fragment,{},n)}},p=a.forwardRef((function(e,n){var t=e.components,o=e.mdxType,r=e.originalType,l=e.parentName,u=s(e,["components","mdxType","originalType","parentName"]),p=c(t),m=o,f=p["".concat(l,".").concat(m)]||p[m]||d[m]||r;return t?a.createElement(f,i(i({ref:n},u),{},{components:t})):a.createElement(f,i({ref:n},u))}));function m(e,n){var t=arguments,o=n&&n.mdxType;if("string"==typeof e||o){var r=t.length,i=new Array(r);i[0]=p;var s={};for(var l in n)hasOwnProperty.call(n,l)&&(s[l]=n[l]);s.originalType=e,s.mdxType="string"==typeof e?e:o,i[1]=s;for(var c=2;c<r;c++)i[c]=t[c];return a.createElement.apply(null,i)}return a.createElement.apply(null,t)}p.displayName="MDXCreateElement"},208:(e,n,t)=>{t.d(n,{Z:()=>i});var a=t(9496),o=t(5924);const r="tabItem_IPoj";function i(e){let{children:n,hidden:t,className:i}=e;return a.createElement("div",{role:"tabpanel",className:(0,o.Z)(r,i),hidden:t},n)}},4210:(e,n,t)=>{t.d(n,{Z:()=>m});var a=t(4250),o=t(9496),r=t(5924),i=t(4375),s=t(4436),l=t(7883),c=t(4930);const u="tabList_xr86",d="tabItem_r4_W";function p(e){var n;const{lazy:t,block:i,defaultValue:p,values:m,groupId:f,className:h}=e,g=o.Children.map(e.children,(e=>{if((0,o.isValidElement)(e)&&"value"in e.props)return e;throw new Error(`Docusaurus error: Bad <Tabs> child <${"string"==typeof e.type?e.type:e.type.name}>: all children of the <Tabs> component should be <TabItem>, and every <TabItem> should have a unique "value" prop.`)})),v=m??g.map((e=>{let{props:{value:n,label:t,attributes:a}}=e;return{value:n,label:t,attributes:a}})),b=(0,s.l)(v,((e,n)=>e.value===n.value));if(b.length>0)throw new Error(`Docusaurus error: Duplicate values "${b.map((e=>e.value)).join(", ")}" found in <Tabs>. Every value needs to be unique.`);const y=null===p?p:p??(null==(n=g.find((e=>e.props.default)))?void 0:n.props.value)??g[0].props.value;if(null!==y&&!v.some((e=>e.value===y)))throw new Error(`Docusaurus error: The <Tabs> has a defaultValue "${y}" but none of its children has the corresponding value. Available values are: ${v.map((e=>e.value)).join(", ")}. If you intend to show no default tab, use defaultValue={null} instead.`);const{tabGroupChoices:x,setTabGroupChoices:k}=(0,l.U)(),[C,w]=(0,o.useState)(y),N=[],{blockElementScrollPositionUntilNextRender:T}=(0,c.o5)();if(null!=f){const e=x[f];null!=e&&e!==C&&v.some((n=>n.value===e))&&w(e)}const E=e=>{const n=e.currentTarget,t=N.indexOf(n),a=v[t].value;a!==C&&(T(n),w(a),null!=f&&k(f,String(a)))},O=e=>{var n;let t=null;switch(e.key){case"Enter":E(e);break;case"ArrowRight":{const n=N.indexOf(e.currentTarget)+1;t=N[n]??N[0];break}case"ArrowLeft":{const n=N.indexOf(e.currentTarget)-1;t=N[n]??N[N.length-1];break}}null==(n=t)||n.focus()};return o.createElement("div",{className:(0,r.Z)("tabs-container",u)},o.createElement("ul",{role:"tablist","aria-orientation":"horizontal",className:(0,r.Z)("tabs",{"tabs--block":i},h)},v.map((e=>{let{value:n,label:t,attributes:i}=e;return o.createElement("li",(0,a.Z)({role:"tab",tabIndex:C===n?0:-1,"aria-selected":C===n,key:n,ref:e=>N.push(e),onKeyDown:O,onClick:E},i,{className:(0,r.Z)("tabs__item",d,null==i?void 0:i.className,{"tabs__item--active":C===n})}),t??n)}))),t?(0,o.cloneElement)(g.filter((e=>e.props.value===C))[0],{className:"margin-top--md"}):o.createElement("div",{className:"margin-top--md"},g.map(((e,n)=>(0,o.cloneElement)(e,{key:n,hidden:e.props.value!==C})))))}function m(e){const n=(0,i.Z)();return o.createElement(p,(0,a.Z)({key:String(n)},e))}},7394:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>u,contentTitle:()=>l,default:()=>m,frontMatter:()=>s,metadata:()=>c,toc:()=>d});var a=t(4250),o=(t(9496),t(9613)),r=t(208),i=t(4210);const s={sidebar_position:4,description:"Defining your own action enhancers and their associated extension."},l="Custom action enhancers",c={unversionedId:"advanced/custom-action-enhancers",id:"advanced/custom-action-enhancers",title:"Custom action enhancers",description:"Defining your own action enhancers and their associated extension.",source:"@site/docs/advanced/custom-action-enhancers.mdx",sourceDirName:"advanced",slug:"/advanced/custom-action-enhancers",permalink:"/func-client/docs/advanced/custom-action-enhancers",draft:!1,editUrl:"https://github.com/paul-thebaud/func-client/tree/main/website/docs/advanced/custom-action-enhancers.mdx",tags:[],version:"current",sidebarPosition:4,frontMatter:{sidebar_position:4,description:"Defining your own action enhancers and their associated extension."},sidebar:"docsSidebar",previous:{title:"Custom transformers",permalink:"/func-client/docs/advanced/custom-transformers"},next:{title:"Custom action runners",permalink:"/func-client/docs/advanced/custom-action-runners"}},u={},d=[{value:"Goal",id:"goal",level:2},{value:"Defining the function",id:"defining-the-function",level:2},{value:"Using the function",id:"using-the-function",level:2},{value:"Defining the extension",id:"defining-the-extension",level:2},{value:"Transforming it to a runner",id:"transforming-it-to-a-runner",level:2}],p={toc:d};function m(e){let{components:n,...t}=e;return(0,o.kt)("wrapper",(0,a.Z)({},p,t,{components:n,mdxType:"MDXLayout"}),(0,o.kt)("h1",{id:"custom-action-enhancers"},"Custom action enhancers"),(0,o.kt)("admonition",{title:"What you'll learn",type:"tip"},(0,o.kt)("ul",{parentName:"admonition"},(0,o.kt)("li",{parentName:"ul"},"Defining a custom action enhancer"),(0,o.kt)("li",{parentName:"ul"},"Providing an extension property to your enhancer"))),(0,o.kt)("p",null,"FuncClient tries to be agnostic of your data source, so sometimes you may\nrequire a custom enhancer to avoid code duplication."),(0,o.kt)("p",null,"This is a simple guide on defining a custom enhancer, but you may also inspire\nfrom any existing FuncClient enhancers."),(0,o.kt)("h2",{id:"goal"},"Goal"),(0,o.kt)("p",null,"Since FuncClient is pagination agnostic, providing a ",(0,o.kt)("inlineCode",{parentName:"p"},"first")," enhancer is\nnot possible. Here is what we want our new ",(0,o.kt)("inlineCode",{parentName:"p"},"first")," enhancer to do:"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"Select the model just like the ",(0,o.kt)("inlineCode",{parentName:"li"},"find")," enhancer, but not a record ID"),(0,o.kt)("li",{parentName:"ul"},"Limit the pagination to the first page and one record only")),(0,o.kt)("p",null,"In this example, we will admit a JSON:API is used with the following query\nparameters working:"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"page[number]")," describes the number of the page to fetch"),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"page[size]")," describes the count of records to fetch (aka. limit)")),(0,o.kt)("admonition",{type:"info"},(0,o.kt)("p",{parentName:"admonition"},"This guide is an enhancer version of the ",(0,o.kt)("inlineCode",{parentName:"p"},"first")," runner described in the\n",(0,o.kt)("a",{parentName:"p",href:"/docs/advanced/custom-action-runners"},(0,o.kt)("strong",{parentName:"a"},"custom runners guide")),".")),(0,o.kt)("h2",{id:"defining-the-function"},"Defining the function"),(0,o.kt)("p",null,"Our implementation of ",(0,o.kt)("inlineCode",{parentName:"p"},"first")," will target the model and paginate the context."),(0,o.kt)(i.Z,{groupId:"language",defaultValue:"ts",values:[{label:"TypeScript",value:"ts"},{label:"JavaScript",value:"js"}],mdxType:"Tabs"},(0,o.kt)(r.Z,{value:"ts",mdxType:"TabItem"},(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-ts",metastring:'title="action/enhancers/first.ts"',title:'"action/enhancers/first.ts"'},"import { Action, Model, ModelInstance, forModel } from 'func-client/core';\nimport { paginate } from 'func-client/jsonapi';\n\nexport default function first<\n    Context extends {},\n    ContextDefinition extends {},\n    ContextInstance extends ModelInstance<ContextDefinition>,\n    ContextModel extends Model<ContextDefinition, ContextInstance>,\n>(model: ContextModel) {\n    return (action: Action<Context>) =>\n        action.use(forModel(model)).use(paginate({ number: 1, size: 1 }));\n}\n"))),(0,o.kt)(r.Z,{value:"js",mdxType:"TabItem"},(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-js",metastring:'title="action/enhancers/first.ts"',title:'"action/enhancers/first.ts"'},"import { forModel } from 'func-client/core';\nimport { paginate } from 'func-client/jsonapi';\n\nexport default function first(model) {\n    return (action) =>\n        action.use(forModel(model)).use(paginate({ number: 1, size: 1 }));\n}\n")))),(0,o.kt)("admonition",{type:"caution"},(0,o.kt)("p",{parentName:"admonition"},"Please note that when defining custom enhancers or runners, you should always\ncorrectly define generic types. This is very important as it will allow the\ncontext propagation through other enhancers and runners.")),(0,o.kt)("h2",{id:"using-the-function"},"Using the function"),(0,o.kt)("p",null,"Once your enhancer is ready, you may use it like any other FuncClient enhancer."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-javascript"},"import { one } from 'func-client/core';\nimport action from './action';\nimport first from './action/enhancers/first';\nimport Post from './models/post';\n\nconst post = await action()\n  .use(first(Post))\n  .run(one());\n")),(0,o.kt)("h2",{id:"defining-the-extension"},"Defining the extension"),(0,o.kt)("p",null,"Our current enhancer can only be used through an import and the ",(0,o.kt)("inlineCode",{parentName:"p"},"use")," method\nof our action. To make it available for the\n",(0,o.kt)("a",{parentName:"p",href:"/docs/actions#extensions"},"builder pattern style calls"),", we must define an\nextension for it."),(0,o.kt)("p",null,"There is currently a limitation of the TypeScript language (Higher Order types\nare not available for now) which forces us to declare each extension manually.\nThe goal of an extension definition is to strongly type the feature provided\nto our action (and so provide autocomplete, context propagation, etc.)."),(0,o.kt)("p",null,"Once your enhancer extension is ready, you will be able to use it\n",(0,o.kt)("a",{parentName:"p",href:"/docs/actions#extensions"},"as any other enhancers of FuncClient"),"."),(0,o.kt)(i.Z,{groupId:"language",defaultValue:"ts",values:[{label:"TypeScript",value:"ts"},{label:"JavaScript",value:"js"}],mdxType:"Tabs"},(0,o.kt)(r.Z,{value:"ts",mdxType:"TabItem"},(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-ts",metastring:'title="action/enhancers/first.ts"',title:'"action/enhancers/first.ts"'},"import {\n    Action,\n    ActionParsedExtension,\n    ConsumeId,\n    ConsumeModel,\n    ConsumeType,\n    forModel,\n    makeEnhancersExtension,\n    Model,\n    ModelInstance,\n} from 'func-client/core';\nimport { paginate } from 'func-client/jsonapi';\n\n// Our previous enhancer code.\nexport default function first<\n    Context extends {},\n    ContextDefinition extends {},\n    ContextInstance extends ModelInstance<ContextDefinition>,\n    ContextModel extends Model<ContextDefinition, ContextInstance>,\n>(model: ContextModel) {\n    return (action: Action<Context>) =>\n        action.use(forModel(model)).use(paginate({ number: 1, size: 1 }));\n}\n\n// The extension typing.\ntype FirstEnhancerExtension = ActionParsedExtension<{\n    first<Context extends {}, Extension extends {}, ContextModel extends Model>(\n        this: Action<Context, Extension>,\n        model: ContextModel,\n    ): Action<\n        Context & ConsumeModel<ContextModel> & ConsumeType & ConsumeId,\n        Extension\n    >;\n}>;\n\n// The extension value.\nfirst.extension = makeEnhancersExtension({ first }) as FirstEnhancerExtension;\n"))),(0,o.kt)(r.Z,{value:"js",mdxType:"TabItem"},(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-js",metastring:'title="action/enhancers/first.ts"',title:'"action/enhancers/first.ts"'},"import { forModel, makeEnhancersExtension } from 'func-client/core';\nimport { paginate } from 'func-client/jsonapi';\n\n// Our previous enhancer code.\nexport default function first(model) {\n    return (action) =>\n        action.use(forModel(model)).use(paginate({ number: 1, size: 1 }));\n}\n\n// The extension value.\nfirst.extension = makeEnhancersExtension({ first });\n")))),(0,o.kt)("admonition",{type:"caution"},(0,o.kt)("p",{parentName:"admonition"},"Here again, correctly typing our enhancer extension is really important to get\ncontext and action's extension propagation.")),(0,o.kt)("h2",{id:"transforming-it-to-a-runner"},"Transforming it to a runner"),(0,o.kt)("p",null,"Wish ",(0,o.kt)("inlineCode",{parentName:"p"},"first")," was not selecting a model but directly running the action\nand fetching a result?"),(0,o.kt)("p",null,"Check out ",(0,o.kt)("a",{parentName:"p",href:"/docs/advanced/custom-action-runners"},"the custom runner guide")," which\ndescribe how to code a ",(0,o.kt)("inlineCode",{parentName:"p"},"first")," action runner."))}m.isMDXComponent=!0}}]);